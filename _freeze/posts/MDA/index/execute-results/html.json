{
  "hash": "cb3731b2af940cdcd9646de6c82eab79",
  "result": {
    "markdown": "---\ntitle: \"FAMD - Factor Analysis of Mixed Data in R\"\ndescription: |\n  Factor Analysis of Mixed Data (FAMD) is a powerful statistical technique used to analyze datasets that contain both numerical and categorical variables.\ncategories: [FAMD, FactoMineR, factoextra]\nauthor:\n  - name: Franklin Santos\n    url: https://franklinsantosm.com\n    affiliation: AgriTech Bolivia\n    orcid: 0000-0002-7509-2910\n    email: franklin25santos@gmail.com\ndate: \"2023-11-29\"\nimage: plot.png\ncitation: true\neditor_options: \n  chunk_output_type: console\n---\n\n```{=html}\n<style>\nbody {\ntext-align: justify}\n</style>\n```\n\n\n\n## Introduction\n\nFactor Analysis of Mixed Data (FAMD) is a powerful statistical technique used to analyze datasets that contain both numerical and categorical variables. It extends traditional factor analysis to handle mixed data types, providing a comprehensive understanding of the underlying structure of complex datasets. In this blog post, we will delve into the essentials of FAMD, exploring its computation, R packages, data format, R code, visualization, and interpretation.\n\n## Computation\n\nFAMD combines multiple techniques, such as Principal Component Analysis (PCA) for numerical variables and Multiple Correspondence Analysis (MCA) for categorical variables. The integration of these methods allows FAMD to effectively capture the relationships between variables and reveal underlying patterns in mixed datasets.\n\n### R Packages\n\nTo perform FAMD in R, the `FactoMineR` and `factoextra` package are widely used and offers a dedicated function for FAMD. Ensure that you have the package installed by running:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(c(\"FactoMineR\", \"factoextra\"))\n```\n:::\n\n\nload packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(FactoMineR)\nlibrary(factoextra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: ggplot2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWelcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa\n```\n:::\n:::\n\n\n### Data Format\n\nBefore applying FAMD, it's crucial to prepare your data appropriately. Ensure that your dataset contains both numerical and categorical variables. Standardize numerical variables if necessary and encode categorical variables properly.\n\nWe’ll use a subset of the `wine` data set available in `FactoMineR` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"FactoMineR\")\ndata(wine)\ndf <- wine[,c(1,2, 16, 22, 29, 28, 30,31)]\nhead(df[, 1:7], 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          Label Soil Plante Acidity Harmony Intensity Overall.quality\n2EL      Saumur Env1  2.000   2.107   3.143     2.857           3.393\n1CHA     Saumur Env1  2.000   2.107   2.964     2.893           3.214\n1FON Bourgueuil Env1  1.750   2.179   3.143     3.074           3.536\n1VAU     Chinon Env2  2.304   3.179   2.038     2.462           2.464\n```\n:::\n:::\n\n\nTo see the structure of the data, type this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t21 obs. of  8 variables:\n $ Label          : Factor w/ 3 levels \"Saumur\",\"Bourgueuil\",..: 1 1 2 3 1 2 2 1 3 1 ...\n $ Soil           : Factor w/ 4 levels \"Reference\",\"Env1\",..: 2 2 2 3 1 1 1 2 2 3 ...\n $ Plante         : num  2 2 1.75 2.3 1.76 ...\n $ Acidity        : num  2.11 2.11 2.18 3.18 2.57 ...\n $ Harmony        : num  3.14 2.96 3.14 2.04 3.64 ...\n $ Intensity      : num  2.86 2.89 3.07 2.46 3.64 ...\n $ Overall.quality: num  3.39 3.21 3.54 2.46 3.74 ...\n $ Typical        : num  3.25 3.04 3.18 2.25 3.44 ...\n```\n:::\n:::\n\n\nThe data contains 21 rows (wines, `individuals`) and 8 columns (`variables`):\n\n- The first two columns are factors (`categorical variables`): `label` (Saumur, Bourgueil or Chinon) and `soil` (Reference, Env1, Env2 or Env4).\n- The remaining columns are numeric (`continuous variables`).\n\n::: callout-tip\nThe goal of this study is to analyze the characteristics of the wines.\n:::\n\n## R Code\n\nThe function `FAMD()` [FactoMiner package] can be used to compute FAMD. A simplified format is:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFAMD (base, ncp = 5, sup.var = NULL, ind.sup = NULL, graph = TRUE)\n```\n:::\n\n\n- `base`: a data frame with n rows (individuals) and p columns (variables).\n- `ncp`: the number of dimensions kept in the results (by default 5)\n- `sup.var`: a vector indicating the indexes of the supplementary variables.\n- `ind.sup`: a vector indicating the indexes of the supplementary individuals.\n- `graph`: a logical value. If TRUE a graph is displayed.\n\nTo compute FAMD, type this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(FactoMineR)\nres.famd <- FAMD(df, graph = FALSE)\n```\n:::\n\n\nThe output of the `FAMD()` function is a list including:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(res.famd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n*The results are available in the following objects:\n\n  name          description                             \n1 \"$eig\"        \"eigenvalues and inertia\"               \n2 \"$var\"        \"Results for the variables\"             \n3 \"$ind\"        \"results for the individuals\"           \n4 \"$quali.var\"  \"Results for the qualitative variables\" \n5 \"$quanti.var\" \"Results for the quantitative variables\"\n```\n:::\n:::\n\n\n### Visualization and Interpretation\n\nWe’ll use the following ***factoextra*** functions:\n\n- `get_eigenvalue(res.famd)`: Extract the eigenvalues/variances retained by each dimension (axis).\n- `fviz_eig(res.famd)`: Visualize the eigenvalues/variances.\n- `get_famd_ind(res.famd)`: Extract the results for individuals.\n- `get_famd_var(res.famd)`: Extract the results for quantitative and qualitative variables.\n- `fviz_famd_ind(res.famd)`, `fviz_famd_var(res.famd)`: Visualize the results for individuals and variables, respectively.\n\nIn the next sections, we’ll illustrate each of these functions.\n\n::: callout-tip\nTo help in the interpretation of FAMD, we highly recommend to read the interpretation of principal component analysis (Chapter (???)(principal-component-analysis)) and multiple correspondence analysis (Chapter (???)(multiple-correspondence-analysis)). Many of the graphs presented here have been already described in our previous chapters.\n:::\n\n### Eigenvalues / Variances\n\nThe proportion of variances retained by the different dimensions (axes) can be extracted using the function `get_eigenvalue()` [factoextra package] as follow:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"factoextra\")\neig.val <- get_eigenvalue(res.famd)\nhead(eig.val)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      eigenvalue variance.percent cumulative.variance.percent\nDim.1  4.8315174        43.922886                    43.92289\nDim.2  1.8568797        16.880724                    60.80361\nDim.3  1.5824794        14.386176                    75.18979\nDim.4  1.1491200        10.446546                    85.63633\nDim.5  0.6518053         5.925503                    91.56183\n```\n:::\n:::\n\n\nThe function fviz_eig() or fviz_screeplot() [factoextra package] can be used to draw the scree plot (the percentages of inertia explained by each FAMD dimensions):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_screeplot(res.famd)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Graph of Variables\n\n#### All variables\n\nThe function `get_mfa_var()` [in ***factoextra***] is used to extract the results for variables. By default, this function returns a list containing the coordinates, the cos2 and the contribution of all variables:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar <- get_famd_var(res.famd)\nvar\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nFAMD results for variables \n ===================================================\n  Name       Description                      \n1 \"$coord\"   \"Coordinates\"                    \n2 \"$cos2\"    \"Cos2, quality of representation\"\n3 \"$contrib\" \"Contributions\"                  \n```\n:::\n:::\n\n\nThe different components can be accessed as follow:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Coordinates of variables\nhead(var$coord)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    Dim.1       Dim.2       Dim.3       Dim.4        Dim.5\nPlante          0.7344160 0.060551966 0.105902048 0.004011299 0.0010340559\nAcidity         0.1732738 0.491118153 0.126394029 0.115376784 0.0045862935\nHarmony         0.8943968 0.023628146 0.040124469 0.003653813 0.0086624633\nIntensity       0.6991811 0.134639254 0.065382234 0.023214984 0.0064730431\nOverall.quality 0.9115699 0.005246728 0.009336677 0.005445276 0.0007961880\nTypical         0.7808611 0.027094327 0.001549791 0.083446627 0.0005912942\n```\n:::\n\n```{.r .cell-code}\n# Cos2: quality of representation on the factore map\nhead(var$cos2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     Dim.1        Dim.2        Dim.3        Dim.4        Dim.5\nPlante          0.53936692 3.666541e-03 1.121524e-02 1.609052e-05 1.069272e-06\nAcidity         0.03002381 2.411970e-01 1.597545e-02 1.331180e-02 2.103409e-05\nHarmony         0.79994566 5.582893e-04 1.609973e-03 1.335035e-05 7.503827e-05\nIntensity       0.48885427 1.812773e-02 4.274836e-03 5.389355e-04 4.190029e-05\nOverall.quality 0.83095973 2.752815e-05 8.717353e-05 2.965103e-05 6.339153e-07\nTypical         0.60974400 7.341026e-04 2.401853e-06 6.963340e-03 3.496288e-07\n```\n:::\n\n```{.r .cell-code}\n# Contributions to the  dimensions\nhead(var$contrib)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    Dim.1      Dim.2      Dim.3      Dim.4      Dim.5\nPlante          15.200526  3.2609526 6.69215972  0.3490757 0.15864490\nAcidity          3.586323 26.4485720 7.98708850 10.0404466 0.70362936\nHarmony         18.511716  1.2724651 2.53554453  0.3179662 1.32899551\nIntensity       14.471254  7.2508336 4.13163258  2.0202401 0.99309457\nOverall.quality 18.867156  0.2825562 0.59000304  0.4738648 0.12215119\nTypical         16.161818  1.4591321 0.09793437  7.2617850 0.09071638\n```\n:::\n:::\n\n\nThe following figure shows the correlation between variables - both quantitative and qualitative variables - and the principal dimensions, as well as, the contribution of variables to the dimensions 1 and 2. The following functions [in the factoextra package] are used:\n\n- `fviz_famd_var()` to plot both quantitative and qualitative variables\n- `fviz_contrib()` to visualize the contribution of variables to the principal dimensions\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot of variables\nfviz_famd_var(res.famd, repel = TRUE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Contribution to the first dimension\nfviz_contrib(res.famd, \"var\", axes = 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Contribution to the second dimension\nfviz_contrib(res.famd, \"var\", axes = 2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-3.png){width=672}\n:::\n:::\n\n\nThe red dashed line on the graph above indicates the expected average value, If the contributions were uniform. Read more in chapter (Chapter @ref(principal-component-analysis)).\n\n::: callout-tip\nFrom the plots above, it can be seen that:\n- variables that contribute the most to the first dimension are: Overall.quality and Harmony.\n- variables that contribute the most to the second dimension are: Soil and Acidity.\n:::\n\n#### Quantitative variables\n\nTo extract the results for quantitative variables, type this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquanti.var <- get_famd_var(res.famd, \"quanti.var\")\nquanti.var\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nFAMD results for quantitative variables \n ===================================================\n  Name       Description                      \n1 \"$coord\"   \"Coordinates\"                    \n2 \"$cos2\"    \"Cos2, quality of representation\"\n3 \"$contrib\" \"Contributions\"                  \n```\n:::\n:::\n\n\nIn this section, we’ll describe how to visualize quantitative variables. Additionally, we’ll show how to highlight variables according to either i) their quality of representation on the factor map or ii) their contributions to the dimensions.\n\nThe R code below plots quantitative variables. We use repel = TRUE, to avoid text overlapping.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_var(res.famd, \"quanti.var\", repel = TRUE,\n              col.var = \"black\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nBriefly, the graph of variables (correlation circle) shows the relationship between variables, the quality of the representation of variables, as well as, the correlation between variables and the dimensions. Read more at PCA (Chapter @ref(principal-component-analysis)), MCA (Chapter @ref(multiple-correspondence-analysis)) and MFA (Chapter @ref(multiple-factor-analysis)).\n\nThe most contributing quantitative variables can be highlighted on the scatter plot using the argument `col.var = \"contrib\"`. This produces a gradient colors, which can be customized using the argument `gradient.cols`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_var(res.famd, \"quanti.var\", col.var = \"contrib\", \n             gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"),\n             repel = TRUE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nSimilarly, you can highlight quantitative variables using their cos2 values representing the quality of representation on the factor map. If a variable is well represented by two dimensions, the sum of the cos2 is closed to one. For some of the items, more than 2 dimensions might be required to perfectly represent the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Color by cos2 values: quality on the factor map\nfviz_famd_var(res.famd, \"quanti.var\", col.var = \"cos2\",\n             gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"), \n             repel = TRUE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n#### Graph of qualitative variables\n\nLike quantitative variables, the results for qualitative variables can be extracted as follow:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquali.var <- get_famd_var(res.famd, \"quali.var\")\nquali.var\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nFAMD results for qualitative variable categories \n ===================================================\n  Name       Description                      \n1 \"$coord\"   \"Coordinates\"                    \n2 \"$cos2\"    \"Cos2, quality of representation\"\n3 \"$contrib\" \"Contributions\"                  \n```\n:::\n:::\n\n\nTo visualize qualitative variables, type this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_var(res.famd, \"quali.var\", col.var = \"contrib\", \n             gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\")\n             )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nThe plot above shows the categories of the categorical variables.\n\n#### Graph of individuals\n\nTo get the results for individuals, type this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind <- get_famd_ind(res.famd)\nind\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nFAMD results for individuals \n ===================================================\n  Name       Description                      \n1 \"$coord\"   \"Coordinates\"                    \n2 \"$cos2\"    \"Cos2, quality of representation\"\n3 \"$contrib\" \"Contributions\"                  \n```\n:::\n:::\n\n\nTo plot individuals, use the function `fviz_mfa_ind()` [in factoextra]. By default, individuals are colored in blue. However, like variables, it’s also possible to color individuals by their cos2 and contribution values:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_famd_ind(res.famd, col.ind = \"cos2\", \n             gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"),\n             repel = TRUE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n::: callout-tip\nIn the plot above, the qualitative variable categories are shown in black. Env1, Env2, Env3 are the categories of the soil. Saumur, Bourgueuil and Chinon are the categories of the wine Label. If you don’t want to show them on the plot, use the argument `invisible = \"quali.var\"`.\n:::\n\nIndividuals with similar profiles are close to each other on the factor map. For the interpretation, read more at Chapter @ref(multiple-correspondence-analysis) (MCA) and Chapter @ref(multiple-factor-analysis) (MFA).\n\nNote that, it’s possible to color the individuals using any of the qualitative variables in the initial data table. To do this, the argument `habillage` is used in the `fviz_famd_ind()` function. For example, if you want to color the wines according to the supplementary qualitative variable “Label”, type this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_mfa_ind(res.famd, \n             habillage = \"Label\", # color by groups \n             palette = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"),\n             addEllipses = TRUE, ellipse.type = \"confidence\", \n             repel = TRUE # Avoid text overlapping\n             ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nIf you want to color individuals using multiple categorical variables at the same time, use the function fviz_ellipses() [in factoextra] as follow:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_ellipses(res.famd, c(\"Label\", \"Soil\"), repel = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: `gather_()` was deprecated in tidyr 1.2.0.\nℹ Please use `gather()` instead.\nℹ The deprecated feature was likely used in the factoextra package.\n  Please report the issue at <https://github.com/kassambara/factoextra/issues>.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nAlternatively, you can specify categorical variable indices:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfviz_ellipses(res.famd, 1:2, geom = \"point\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n## Summary\n\nFactor Analysis of Mixed Data (FAMD) is a versatile tool for analyzing datasets with a mix of numerical and categorical variables. Through the 'FactoMineR' package in R, users can seamlessly perform FAMD, gaining valuable insights into the underlying structure of their data. By visualizing eigenvalues, variable contributions, and individual distributions, researchers can interpret complex relationships and make informed decisions based on the extracted factors. Incorporate FAMD into your analytical toolkit to unlock the full potential of mixed data analysis.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}